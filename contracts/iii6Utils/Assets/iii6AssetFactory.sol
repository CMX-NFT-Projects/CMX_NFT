// SPDX-License-Identifier: GPL-3.0
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //
//
//      MMWKd:..                                                                                    ..:dKWMM
//      MKl.                                                                                            .lKW
//      O'       ..''''''''''''.     .''''''.     .'''''.      .''''''''''''''.     .''''''''''''..       'O
//      '     .ckKNNWNWWWWWWWWWk.   .xNWWNWNl    ,0WWWWW0,     lNWWWWWWWWWNWNk'    ;0NNNWWWWWWWWNNKkc.     '
//           ,OWMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMMMMMMMMM0,    ;KMMMMMMMMMMMMMMMMWO,
//          .kMMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMMMMMMMM0,    ;KMMMMMMMMMMMMMMMMMMMk.
//          '0MMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMMMMMMM0,    :KMMMMMMMMMMMMMMMMMMMM0'
//          '0MMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMMMMMM0,    :KMMMMMMMMMMMMMMMMMMMMM0'
//          '0MMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMMMMM0,    ;0NNWWMMMMMMMMMMMMMMMMMM0'
//          '0MMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMMMM0,     .'.',;lkNMMMMMMMMMMMMMMM0'
//          '0MMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMMMK;              ,kWMMMMMMMMMMMMM0'
//          '0MMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMMX:    .:oxxdc'    .dWMMMMMMMMMMMM0'
//          '0MMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMWd.   ,OWMMMMMXl.   '0MMMMMMMMMMMM0'
//          '0MMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMX;   .kMMMMMMMMK,   .xMMMMMMMMMMMM0'
//          '0MMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMM0'   .OMMMMMMMMX;   .xMMMMMMMMMMMM0'
//          .OMMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMK,    lNMMMMMMWx.   '0MMMMMMMMMMMMO.
//           lNMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMWd.   .:x0KKKkc.   .dWMMMMMMMMMMMNl
//      .    .c0WMMMMMMMMMMMMMMO.   .kMMMMMWo    ,KMMMMMK,     lWMMMMNd.     ....     .xNMMMMMMMMMMW0c.    .
//      l      .,lddxxxxxxxxxxxc.    :xxxxxd,    .lxxxxxl.     ,dxxxxxd:.            .cdxxxxxxxxddl,.      l
//      No.                                                                                              .oN
//      MW0l'                                                                                          'l0WM
//      MMMWKd;.                                                                                    .;dKWMMM
//
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //
//                                                                                                                                                                                  //
//      @dev            ::              Aron Mauritala Ayuk                                                                                                                                          //
//      @msg            ::              stereo@iii6.xyz                                                                                                                                   //
//      @github         ::              @stereoIII6
//      @twitter        ::              @stereoIII6                                                                                                                                              //
//                                                                                                                                                                                  //
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //
//                                                                                                                                                                                  //
//      @dev            ::              Juan Xavier Valverde                                                                                                                                    //
//      @msg            ::              juanxavier@iii6.xyz                                                                                                                               //
//      @twitter        ::              @JuanXavier                                                                                                                                             //
//      @github         ::              @JuanXavier                                                                                                                                             //
//                                                                                                                                                                                  //                                                                                                                                                                                 //
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //
//  *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   //
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //
//                                                                                                                                                                                  //
//      @company        ::              Fractio Holding                                                                                                                                                                       //
//      @title          ::              iii6 Coin Factory                                                                                                                            //
//      @description    ::              ERC721 DIA Factory Contract                                                                                                                           //
//      @version        ::              0.0.1                                                                                                                                       //
//      @purpose        ::              ERC721 DIA Factory                                                                                                          //
//                                                                                                                                                                                  //
//                                                                                                                                                                                  //
//                                                                                                                                                                                  //
//                                                                                                                                                                                  //
//                                                                                                                                                                                  //
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //
//  *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   //
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

pragma solidity ^0.8.7;

import "./iii6CoinModel.sol";
import "./iii6DiaModel.sol";
import "../Math/iii6PriceMath.sol";

contract iii6AssetFactory is iii6DiaModel, iii6PriceMath {
    /**
     * @dev this contract is a model contract to be deployed through the iii6AssetFactory
     */
    // ██╗███╗░░██╗██╗████████╗██╗░█████╗░██╗░░░░░██╗░██████╗░█████╗░████████╗██╗░█████╗░███╗░░██╗
    // ██║████╗░██║██║╚══██╔══╝██║██╔══██╗██║░░░░░██║██╔════╝██╔══██╗╚══██╔══╝██║██╔══██╗████╗░██║
    // ██║██╔██╗██║██║░░░██║░░░██║███████║██║░░░░░██║╚█████╗░███████║░░░██║░░░██║██║░░██║██╔██╗██║
    // ██║██║╚████║██║░░░██║░░░██║██╔══██║██║░░░░░██║░╚═══██╗██╔══██║░░░██║░░░██║██║░░██║██║╚████║
    // ██║██║░╚███║██║░░░██║░░░██║██║░░██║███████╗██║██████╔╝██║░░██║░░░██║░░░██║╚█████╔╝██║░╚███║
    // ╚═╝╚═╝░░╚══╝╚═╝░░░╚═╝░░░╚═╝╚═╝░░╚═╝╚══════╝╚═╝╚═════╝░╚═╝░░╚═╝░░░╚═╝░░░╚═╝░╚════╝░╚═╝░░╚══╝
    address VRF;
    address FEED;
    uint256 public licenseFee;
    mapping(address => uint256) public licenseRange;
    uint256 public p;
    mapping(uint256 => address) public projects;
    mapping(address => uint256) public mp;
    mapping(address => mapping(uint256 => address)) public myProjects;

    /*
     * @dev this constructor creates a Dia NFT Token Contract
     * @param _owner contract admin
     * @param _name dia token name
     * @param _max amount of tokens 0 = infinte
     * @param _price amount of gascoin for token
     * @param _cName name of related ERC20 token
     * @param _cSym symbol of related ERC20 token
     * @param _c bool if related coin exists
     * @param _cs max supply of related ERC20 token 0 = infinite
     * @param _rate price of related ERC20 token in gascoin
     * @param _g number of greenlist slots for Dia NFT project 0 = no greenlist
     */
    constructor(
        string memory _name,
        string memory _sym,
        string memory _name20,
        string memory _sym20
    ) iii6DiaModel(msg.sender, _name, _sym, 0, 0, "", "", false, 0, 0, 0) {}

    // set the value of fee for asset creation
    function _setLicenseFee(uint256 _fee) internal returns (uint256) {
        return licenseFee = _fee * 10**16; // 100 = 1 ETH
    }

    function _setLicense(address _adr, uint256 _years)
        internal
        returns (uint256)
    {
        if (licenseRange[_adr] > block.timestamp) {
            uint256 dif = licenseRange[_adr] - block.timestamp;
            return licenseRange[_adr] += dif + 60 * 60 * 24 * 365 * _years;
        } else return licenseRange[_adr] += 60 * 60 * 24 * 365 * _years;
    }

    // function creates a ERC20 Token Contract
    function _makeERC20Asset(
        string memory _name,
        string memory _sym,
        uint256 _rate,
        uint256 _supply,
        bool _burn,
        bool _pause,
        uint256 _curr
    ) internal returns (address) {
        // chose token model
        iii6CoinModel token;
        /**
         * @dev creates an instance of iii6CoinModel
         * @param _name token name
         * @param _sym token symbol
         * @param _rate token rate
         * @param _supply max token supply // if 0-infinte
         * @param _burn bool burnable
         * @param _pause bool pauseble
         * @param _curr denomintaor currency // 0-eth 1-gascoin 2-xCur 2-yCur >4-usdc
         * @return contract address
         */
        token = new iii6CoinModel(
            _name,
            _sym,
            _rate,
            _supply,
            _burn,
            _pause,
            _curr
        );
        // exit with address
        return address(token);
    }

    // function creates a ERC721 Token Contract
    function _makeERC721Asset(
        string memory _name,
        uint256 _max,
        uint256 _price,
        uint256 _g
    ) internal returns (address) {
        // chose token model
        iii6DiaModel diaProject;
        /**
         * @dev this constructor creates a Dia NFT Token Contract
         * @param _owner contract admin
         * @param _name dia token name
         * @param _max amount of tokens 0 = infinte
         * @param _price amount of gascoin for Dia token
         * @param _cName name of related ERC20 token
         * @param _cSym symbol of related ERC20 token
         * @param _c bool if related coin exists
         * @param _cs max supply of related ERC20 token 0 = infinite
         * @param _rate price of related ERC20 token in gascoin
         * @param _g number of greenlist slots for Dia NFT project 0 = no greenlist
         */
        diaToken = new iii6DiaModel(
            msg.sender,
            _name,
            _max,
            _price,
            "",
            "",
            false,
            0,
            0,
            _g
        );
        return address(diaToken);
    }

    function buyLicense(uint256 _years) external returns (uint256) {
        if (msg.value < _years * licenseFee) revert Insufficient_Funds();
        return _setLicense(msg.sender, _years);
    }

    /**
     * @dev creates an instance of iii6CoinModel
     * @param _name token name
     * @param _sym token symbol
     * @param _rate token rate
     * @param _supply max token supply // if 0-infinte
     * @param _burn bool burnable
     * @param _pause bool pauseble
     * @param _curr denomintaor currency // 0-eth 1-gascoin 2-xCur 2-yCur >4-usdc
     * @return contract address
     */
    function buildERC20Token(
        string calldata _name,
        string calldata _sym,
        uint256 _rate,
        uint256 _supply,
        bool _burn,
        bool _pause,
        uint256 _curr
    ) external payable returns (address) {
        // check msg.value
        if (msg.value < licenseFee / 10 || licenseRange > block.timestamp)
            revert Insufficient_Funds();
        // mint license
        // make asset & exit with address
        return
            _makeERC20Asset(_name, _sym, _rate, _supply, _burn, _pause, _curr);
    }

    /**
     * @dev function
     * @param _owner contract admin
     * @param _name dia token name
     * @param _max amount of tokens 0 = infinte
     * @param _price amount of gascoin for Dia token
     * @param _cName name of related ERC20 token
     * @param _cSym symbol of related ERC20 token
     * @param _c bool if related coin exists
     * @param _cs max supply of related ERC20 token 0 = infinite
     * @param _rate price of related ERC20 token in gascoin
     * @param _g number of greenlist slots for Dia NFT project 0 = no greenlist
     */
    function buildERC721Token(
        string calldata _name,
        uint256 _max,
        uint256 _price,
        uint256 _g
    ) external payable returns (address) {
        if (msg.value < licenseFee / 5 || licenseRange > block.timestamp)
            revert Insufficient_Funds();

        return _makeERC721Asset(_name, _max, _price, _g);
    }
}
