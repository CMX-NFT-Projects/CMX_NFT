// SPDX-License-Identifier: GPL-3.0
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //
//
//      MMWKd:..                                                                                    ..:dKWMM
//      MKl.                                                                                            .lKW
//      O'       ..''''''''''''.     .''''''.     .'''''.      .''''''''''''''.     .''''''''''''..       'O
//      '     .ckKNNWNWWWWWWWWWk.   .xNWWNWNl    ,0WWWWW0,     lNWWWWWWWWWNWNk'    ;0NNNWWWWWWWWNNKkc.     '
//           ,OWMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMMMMMMMMM0,    ;KMMMMMMMMMMMMMMMMWO,
//          .kMMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMMMMMMMM0,    ;KMMMMMMMMMMMMMMMMMMMk.
//          '0MMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMMMMMMM0,    :KMMMMMMMMMMMMMMMMMMMM0'
//          '0MMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMMMMMM0,    :KMMMMMMMMMMMMMMMMMMMMM0'
//          '0MMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMMMMM0,    ;0NNWWMMMMMMMMMMMMMMMMMM0'
//          '0MMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMMMM0,     .'.',;lkNMMMMMMMMMMMMMMM0'
//          '0MMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMMMK;              ,kWMMMMMMMMMMMMM0'
//          '0MMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMMX:    .:oxxdc'    .dWMMMMMMMMMMMM0'
//          '0MMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMWd.   ,OWMMMMMXl.   '0MMMMMMMMMMMM0'
//          '0MMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMX;   .kMMMMMMMMK,   .xMMMMMMMMMMMM0'
//          '0MMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMM0'   .OMMMMMMMMX;   .xMMMMMMMMMMMM0'
//          .OMMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMK,    lNMMMMMMWx.   '0MMMMMMMMMMMMO.
//           lNMMMMMMMMMMMMMMMMO.   .kMMMMMWl    ,KMMMMMK,     lWMMMWd.   .:x0KKKkc.   .dWMMMMMMMMMMMNl
//      .    .c0WMMMMMMMMMMMMMMO.   .kMMMMMWo    ,KMMMMMK,     lWMMMMNd.     ....     .xNMMMMMMMMMMW0c.    .
//      l      .,lddxxxxxxxxxxxc.    :xxxxxd,    .lxxxxxl.     ,dxxxxxd:.            .cdxxxxxxxxddl,.      l
//      No.                                                                                              .oN
//      MW0l'                                                                                          'l0WM
//      MMMWKd;.                                                                                    .;dKWMMM
//
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //
//                                                                                                                                                                                  //
//      @dev            ::              Aron Mauritala Ayuk                                                                                                                                          //
//      @msg            ::              stereo@iii6.xyz                                                                                                                                   //
//      @github         ::              @stereoIII6
//      @twitter        ::              @stereoIII6                                                                                                                                              //
//                                                                                                                                                                                  //
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //
//                                                                                                                                                                                  //
//      @dev            ::              Juan Xavier Valverde                                                                                                                                    //
//      @msg            ::              juanxavier@iii6.xyz                                                                                                                               //
//      @twitter        ::              @JuanXavier                                                                                                                                             //
//      @github         ::              @JuanXavier                                                                                                                                             //
//                                                                                                                                                                                  //                                                                                                                                                                                 //
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //
//  *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   //
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //
//                                                                                                                                                                                  //
//      @company        ::              Fractio Holding                                                                                                                                                                       //
//      @title          ::              iii6 Safes                                                                                                                            //
//      @description    ::              This is a Asset Safe for all Board Members                                                                                                                            //
//      @version        ::              0.0.1                                                                                                                                       //
//      @purpose        ::              Multinet Address Storage                                                                                                           //
//                                                                                                                                                                                  //
//                                                                                                                                                                                  //
//                                                                                                                                                                                  //
//                                                                                                                                                                                  //
//                                                                                                                                                                                  //
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //
//  *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   //
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

pragma solidity ^0.8.7;

import "./iii6CoinModel.sol";
import "../Misc/iii6GlobalEnums.sol";
import "../Misc/iii6Logs.sol";
import "../Math/iii6Math.sol";

contract iii6SafeModel is iii6CoinModel, iii6GlobalEnums, iii6Math {
    uint256 public mTRUST;
    // token balance stored on contract
    // token contrat address => balance
    mapping(address => uint256) public xTRUST;
    // list of trustees
    address[] TRUSTEE;
    uint256 trc;
    // transaction count starting at 1
    uint256 public TX;
    // json scheme for boardmember
    struct BoardMember {
        uint256 b_id;
        address adr;
        uint256 share;
        string info;
    }
    // json scheme for Proposals
    struct Proposal {
        uint rid;
        uint voteCount;
        address[] members;
        uint[] shares;
        bool[] votes;
        Voting state;
    }
    // array of board members
    BoardMember[] public members;
    // array of proposals
    Proposal[] public proposals;
    // board member id callback from address
    mapping(address => uint256) public memNum;
    // number of board members starting at 1
    uint256 bms;
    // max number of board members starting at 1
    uint256 maxMembers;
    // minimumshare out of 100000
    uint256 minShare;
    // redistribution count
    uint rid;
    // redistribution approval mapping
    // rid => address => bool


    constructor(
        string memory _name,
        string memory _sym,
        uint256 _maxMem,
        uint256 _minShare
    ) iii6CoinModel(_name, _sym, 0, 100000, msg.sender) {
        TRUSTEE[0] = msg.sender; // first trustee
        trc++; // number of trustees
        bms = 1; // number of board members
        mTRUST = 0; // gas coin balance stored on contract
        TX = 1; // number of TX
        digits = 0;
        maxMembers = _maxMem; // max number of members
        minShare = _minShare; // set minimum share min 1
        _mint(address(this), 100000);
    }

    function setSafe(uint256 _maxMem, uint256 _minShare)
        external
        returns (uint256, uint256)
    {
        require(
            msg.sender == TRUSTEE[0] || balanceOf(msg.sender) > 50,
            "not permitted to add a member"
        );
        maxMembers = _maxMem; // max number of members
        minShare = _minShare; // set minimum share
        return (maxMembers, minShare);
    }

    function addMember(address _adr, string memory _inf)
        external
        returns (address)
    {
        require(
            msg.sender == TRUSTEE[0] || balanceOf(msg.sender) > 50,
            "not permitted to add a member"
        );
        require(members.length < maxMembers, "board filled");
        members[bms] = BoardMember(bms, _adr, 0, _inf);
        isMem[_adr] = true;
        memNum[_adr] = bms;
        bms++;
        return _adr;
    }

    function _shareToMember(address _adr, _amount) internal returns (bool) {
        bool state = false;
        uint256 num = memNum[_adr];
        require(num > 0, "not a board member");
        member = members[num];
        member.share = _amount;
        if (member.share != members[num].share) {
            state = true;
        }
        members[num] = member;
        return state;
    }

    function proposeRedistribution(address[] _members, uint[] _shares) external returns(bool){
        if(rid == 0){
            // first redistribution
            rid=1;
            // check member count and share count 
            require(_members.length == bms && _shares.length == bms && bms <= maxMembers,":: problem with members and shares ::");
            // create approvals uint[] with numMembers Elements
            uint[] memory approvals;
            // check if shares are total < 100000
            uint cumu = 0;
            for(uint i = 1; i <= _members.length; i++){
                approvals.push = 0;
                cumu += _shares[i];
            }
            require(cumu <= 100000,":: shares overflow ::");
            // create first proposal 
            proposals[rid] = Proposal(rid, 0,_members,_shares,approvals,Voting.Active);
            rid++;
        }
        else{
            // require(proposals[rid - 1]);
        }
    }
    function _checkLastProposal() internal returns(bool) {}
    function cancelLastProposal() external returns(bool)

}
